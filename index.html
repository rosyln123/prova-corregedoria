<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal da Corregedoria PM-SP</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome (√çcones) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        /* Estilos personalizados para o tema PM-SP */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5; /* Fundo cinza claro */
        }

        /* 1. Barra Preta Superior */
        .top-header-bar {
            background-color: #2a2a2a;
            color: #d1d1d1;
            font-size: 0.8rem;
        }
        .top-header-bar a {
            color: #d1d1d1;
            transition: color 0.3s;
        }
        .top-header-bar a:hover {
            color: #fff;
        }
        .social-icons a {
            margin-left: 10px;
        }

        /* 2. Cabe√ßalho Branco Principal */
        .main-header-bar {
            background-color: #fff;
            border-bottom: 1px solid #e0e0e0;
        }

        /* 3. Barra de Navega√ß√£o Principal */
        .main-nav-bar {
            background-color: #2c3e50; /* Azul escuro PM */
            color: #fff;
            border-bottom: 3px solid #f39c12; /* Laranja PM */
        }
        .nav-link {
            padding: 1rem 1.5rem;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #34495e; /* Azul mais escuro */
        }

        /* Rodap√© */
        .main-footer {
            background-color: #333;
            color: #ccc;
            padding: 4rem 0;
            font-size: 0.9rem;
        }
        .footer-column h4 {
            color: #fff;
            font-weight: 600;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
            padding-bottom: 0.5rem;
        }
        .footer-column ul li {
            margin-bottom: 0.5rem;
        }
        .footer-column ul li a {
            color: #ccc;
            transition: color 0.3s;
        }
        .footer-column ul li a:hover {
            color: #fff;
        }
        .footer-bottom {
            background-color: #222;
            color: #aaa;
            padding: 1.5rem 0;
            text-align: center;
        }

        /* Estilos dos Bot√µes */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2c3e50;
            color: #fff;
        }
        .btn-primary:hover {
            background-color: #34495e;
        }
        .btn-success {
            background-color: #28a745;
            color: #fff;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .btn-danger {
            background-color: #dc3545;
            color: #fff;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Estilos dos Inputs */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.2);
        }

        /* Modal (usado para login, alertas, etc) */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 40;
        }
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            z-index: 50;
            width: 90%;
            max-width: 500px;
        }

        /* Layout da Prova */
        #exam-page {
            display: flex;
        }
        .exam-sidebar {
            width: 280px;
            background-color: #fff;
            padding: 1.5rem;
            border-right: 1px solid #e0e0e0;
            height: 100vh;
            position: sticky;
            top: 0;
        }
        .exam-content {
            flex: 1;
            padding: 2rem 3rem;
            background-color: #f9f9f9;
        }
        .question-option {
            display: block;
            background-color: #fff;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .question-option:hover {
            border-color: #2c3e50;
        }
        .question-option.selected {
            border-color: #2c3e50;
            background-color: #eaf2f8;
            box-shadow: 0 0 0 2px #2c3e50;
        }

        /* NOVO ESTILO: Card de Not√≠cia (Simples e Limpo) */
        .simple-news-card {
            @apply bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 ease-in-out;
        }
        .simple-news-card:hover {
            @apply shadow-xl transform -translate-y-1;
        }
        .news-card-img {
            @apply w-full h-48 object-cover; /* Altura fixa para as imagens */
        }
        .news-card-title {
            @apply text-lg font-semibold text-gray-800;
        }

    </style>
</head>
<body class="antialiased">

    <!-- CABE√áALHO COMPLETO -->
    <header>
        <!-- 1. Barra Preta Superior -->
        <div class="top-header-bar py-2">
            <div class="container mx-auto max-w-7xl px-4 md:px-8 flex justify-between items-center">
                <span><a href="#" target="_blank">S√£o Paulo, 17 de Novembro de 2025</a></span>
                <div class="flex items-center">
                    <a href="#" class="mr-4">Acessibilidade</a>
                    <a href="#" class="mr-4">governo.sp.gov.br</a>
                    <div class="social-icons">
                        <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="#" title="Flickr"><i class="fab fa-flickr"></i></a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2. Cabe√ßalho Branco Principal -->
        <div class="main-header-bar py-4">
            <div class="container mx-auto max-w-7xl px-4 md:px-8 flex justify-between items-center">
                <!-- LOGO SEM O NAV-LINK PARA CORRIGIR BORDA AZUL -->
                <a href="#" data-page="home" class="block"> 
                    <img src="https://i.ibb.co/M5M8mx54/1.jpg" alt="[Imagem do logo da Pol√≠cia Militar SP]" class="h-20 mr-4"> 
                </a>
                <div class="text-right flex items-center">
                    <!-- √çCONE DA CORREGEDORIA REMOVIDO -->
                    <a href="#" class="text-gray-600 hover:text-gray-900"><i class="fas fa-desktop mr-2"></i> Servi√ßos ao PM</a>
                </div>
            </div>
        </div>

        <!-- 3. Barra de Navega√ß√£o Principal (com nossas p√°ginas) -->
        <nav class="main-nav-bar">
            <div class="container mx-auto max-w-7xl px-4 md:px-8 flex justify-start items-center">
                <a href="#" class="nav-link active" data-page="home">Portal de Not√≠cias</a>
                <a href="#" class="nav-link" data-page="exam-main">Concursos</a>
                <a href="#" class="nav-link" data-page="results">Verificar Resultado</a>
                <!-- Link "Fale Conosco" agora abre o modal de admin -->
                <a href="#" class="nav-link" data-page="admin-trigger">Fale Conosco</a>
            </div>
        </nav>
    </header>

    <!-- CONTE√öDO PRINCIPAL (P√ÅGINAS) -->
    <main id="app-container" class="container mx-auto max-w-7xl p-4 md:p-8">

        <!-- P√ÅGINA: Home -->
        <div id="page-home" class="page-content">

            <!-- Se√ß√£o de Not√≠cias Recentes (NOVO ESTILO LIMPO) -->
            <section class="mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-gray-300 pb-2">√öltimas Not√≠cias</h2>
                
                <!-- GRID DE 3 COLUNAS SIMPLES -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- Not√≠cia 1 -->
                    <div class="simple-news-card">
                        <img src="https://i.postimg.cc/nLWnJKY3/1c6bbf27-5792-4f51-8525-2af05ad6fe2c-CA-LDT.jpg" alt="Homem √© preso em flagrante por transbordo de carga" class="news-card-img">
                        <div class="p-4">
                            <h3 class="news-card-title">Homem √© preso em flagrante por transbordo de carga</h3>
                        </div>
                    </div>
                    
                    <!-- Not√≠cia 2 -->
                    <div class="simple-news-card">
                        <img src="https://i.postimg.cc/FK6h4bgB/9a78808f-8550-40a2-bce4-05d1428f9d35-CA-LDT.jpg" alt="Casal √© detido pela ROTA" class="news-card-img">
                        <div class="p-4">
                            <h3 class="news-card-title">Casal √© detido pela ROTA ap√≥s descoberta de planta√ß√£o de maconha</h3>
                        </div>
                    </div>
                    
                    <!-- Not√≠cia 3 -->
                    <div class="simple-news-card">
                        <img src="https://i.postimg.cc/Ghjr2nxD/e319427d-f319-4469-91e7-b377f366ba5c-CA-LDT.jpg" alt="Criminosos s√£o presos" class="news-card-img">
                        <div class="p-4">
                            <h3 class="news-card-title">Criminosos s√£o presos por roubo e c√°rcere privado</h3>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Se√ß√£o de Contato (MODIFICADA) -->
            <section class="mt-16 bg-white p-8 rounded-lg shadow-md">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Canal de Den√∫ncias</h2>
                <p class="text-lg text-gray-600 mb-6">
                    Para registrar uma den√∫ncia, utilize o portal oficial da Corregedoria.
                </p>
                <!-- Bot√£o de Den√∫ncia (link do usu√°rio) -->
                <a href="https://denunciasssp.netlify.app/" target="_blank" class="btn btn-primary text-lg">
                    Acessar Portal de Den√∫ncias
                </a>
            </section>
        </div>

        <!-- P√ÅGINA: Prova (dividida em 3 etapas) -->
        <div id="page-exam-main" class="page-content hidden">
            
            <!-- Etapa 1: Identifica√ß√£o -->
            <div id="exam-step-1" class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                <h1 class="text-3xl font-bold text-center mb-6">Concurso Interno - Prova de Admiss√£o</h1>
                <p class="text-center text-gray-600 mb-8">Por favor, preencha seus dados para iniciar a prova. Voc√™ ter√° 20 minutos.</p>
                <div class="space-y-4">
                    <div>
                        <label for="name" class="block font-semibold">Nome no Jogo:</label>
                        <input type="text" id="name" class="form-input" required>
                    </div>
                    <div>
                        <label for="discord" class="block font-semibold">Discord (DC):</label>
                        <input type="text" id="discord" class="form-input" required>
                    </div>
                    <div>
                        <label for="idRg" class="block font-semibold">ID/RG:</label>
                        <input type="text" id="idRg" class="form-input" required>
                    </div>
                    <div>
                        <label for="phone" class="block font-semibold">Telefone:</label>
                        <input type="text" id="phone" class="form-input" required>
                    </div>
                    <button id="start-exam-btn" class="btn btn-primary w-full text-lg">
                        Iniciar Prova
                    </button>
                </div>
            </div>

            <!-- Etapa 2: A Prova -->
            <div id="exam-step-2" class="hidden">
                <div class="exam-sidebar">
                    <h2 class="text-xl font-bold mb-4">Concurso</h2>
                    <div class="mb-6">
                        <h3 class="font-semibold text-lg">üõ°Ô∏è Anti-Fraude</h3>
                        <p class="text-sm text-gray-600">Foco total √© obrigat√≥rio.</p>
                        <p class="text-sm text-red-600 font-bold">Trocar de aba ou copiar/colar resultar√° em REPROVA√á√ÉO imediata.</p>
                    </div>
                    <div class="mb-6">
                        <h3 class="font-semibold text-lg">‚è∞ Tempo Restante</h3>
                        <div id="timer" class="text-3xl font-bold text-red-600">20:00</div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-lg">üìÑ Quest√µes</h3>
                        <p id="question-counter" class="text-lg">Quest√£o 1 de 12</p>
                    </div>
                </div>

                <div class="exam-content">
                    <div id="question-container">
                        <!-- Quest√µes s√£o renderizadas aqui pelo JS -->
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button id="prev-question-btn" class="btn btn-primary" disabled>Anterior</button>
                        <button id="next-question-btn" class="btn btn-primary">Pr√≥xima</button>
                        <button id="submit-exam-btn" class="btn btn-success hidden text-lg">Enviar Prova</button>
                    </div>
                </div>
            </div>

            <!-- Etapa 3: Resultado do Envio -->
            <div id="exam-step-3" class="hidden max-w-2xl mx-auto text-center">
                <div id="exam-success-msg" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-6 rounded-lg shadow-lg">
                    <h1 class="text-3xl font-bold mb-4">Prova Conclu√≠da!</h1>
                    <p class="text-lg">Suas respostas foram enviadas com sucesso. Os resultados ser√£o divulgados em breve.</p>
                    <p>Voc√™ pode fechar esta p√°gina.</p>
                </div>
                <div id="exam-fail-msg" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-6 rounded-lg shadow-lg">
                    <h1 class="text-3xl font-bold mb-4">REPROVADO</h1>
                    <p class="text-lg">Voc√™ foi reprovado automaticamente por tentativa de fraude (trocar de aba ou copiar/colar).</p>
                    <p>O registro foi salvo no sistema.</p>
                </div>
                <div id="exam-blocked-msg" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 rounded-lg shadow-lg">
                    <h1 class="text-3xl font-bold mb-4">Tentativa √önica</h1>
                    <p class="text-lg">Nosso sistema registrou que voc√™ j√° realizou esta prova. N√£o √© permitido realizar a prova novamente.</p>
                </div>
            </div>
        </div>

        <!-- P√ÅGINA: Verificar Resultado -->
        <div id="page-results" class="page-content hidden max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-6">Verificar Resultado</h1>
            <p class="text-center text-gray-600 mb-8">Digite seu ID/RG utilizado na prova para verificar o status.</p>
            <div class="flex">
                <input type="text" id="search-idRg" class="form-input rounded-r-none" placeholder="Digite seu ID/RG">
                <button id="search-result-btn" class="btn btn-primary rounded-l-none">Buscar</button>
            </div>
            <div id="result-display" class="mt-8 p-6 bg-white rounded-lg shadow-md hidden">
                <!-- Resultado da busca aparece aqui -->
            </div>
        </div>

        <!-- P√ÅGINA: Admin -->
        <div id="page-admin" class="page-content hidden">
            <h1 class="text-3xl font-bold mb-6">Painel do Administrador</h1>
            <p class="text-gray-600 mb-6">Visualize e gerencie os resultados das provas enviadas.</p>
            <div id="admin-results-table" class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="py-2 px-4 text-left">Nome</th>
                            <th class="py-2 px-4 text-left">ID/RG</th>
                            <th class="py-2 px-4 text-left">Discord</th>
                            <th class="py-2 px-4 text-left">Status</th>
                            <th class="py-2 px-4 text-left">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body">
                        <!-- Linhas da tabela s√£o preenchidas pelo JS -->
                        <tr><td colspan="5" class="py-4 text-center text-gray-500">Carregando resultados...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- RODAP√â COMPLETO -->
    <footer class="main-footer mt-16">
        <div class="container mx-auto max-w-7xl px-4 md:px-8">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                <!-- Coluna 1 -->
                <div class="footer-column">
                    <h4>Institucional</h4>
                    <ul>
                        <li><a href="#">Bras√£o de Armas</a></li>
                        <li><a href="#">Can√ß√£o da PM</a></li>
                        <li><a href="#">Capacita√ß√£o e Treinamento</a></li>
                        <li><a href="#">Hist√≥ria da PM</a></li>
                        <li><a href="#">Ins√≠gnias</a></li>
                        <li><a href="#">Legisla√ß√£o</a></li>
                        <li><a href="#">Nossos Autores</a></li>
                        <li><a href="#">Organiza√ß√£o</a></li>
                        <li><a href="#">Planejamento Estrat√©gico</a></li>
                        <li><a href="#">Portal de Not√≠cias</a></li>
                        <li><a href="#">Voltar Hist√≥rico</a></li>
                    </ul>
                </div>
                <!-- Coluna 2 -->
                <div class="footer-column">
                    <h4>Programas de Policiamento</h4>
                    <ul>
                        <li><a href="#">Policiamento Escolar</a></li>
                        <li><a href="#">For√ßas T√°ticas</a></li>
                        <li><a href="#">RadioPatrulha - Atendimento 190</a></li>
                        <li><a href="#">ROCAM</a></li>
                        <li><a href="#">Policiamento de Tr√¢nsito</a></li>
                        <li><a href="#">Policiamento Comunit√°rio</a></li>
                    </ul>
                </div>
                <!-- Coluna 3 -->
                <div class="footer-column">
                    <h4>Servi√ßos</h4>
                    <ul>
                        <li><a href="#">Boletim de Ocorr√™ncia Eletr√¥nico</a></li>
                        <li><a href="#">Delegacia Eletr√¥nica</a></li>
                        <li><a href="#">Cadastro de pessoa surda, de PCD auditiva ou fala</a></li>
                        <li><a href="#">Informa√ß√µes das Rodovias</a></li>
                        <li><a href="#">Aplicativos PMESP</a></li>
                        <li><a href="#">Orienta√ß√µes de Seguran√ßa</a></li>
                        <li><a href="#">O que a PM est√° fazendo por voc√™</a></li>
                        <li><a href="#">Roteiro Cultural</a></li>
                        <li><a href="#">Canal de Imprensa</a></li>
                    </ul>
                </div>
                <!-- Coluna 4 -->
                <div class="footer-column">
                    <h4>Concursos</h4>
                    <ul>
                        <li><a href="#">COMSEC</a></li>
                        <li><a href="#">CONSEG</a></li>
                        <li><a href="#">Fale Conosco</a></li>
                        <li><a href="#">Pesquisas CIAF</a></li>
                        <li><a href="#">Acesso ao sistema Infralab</a></li>
                        <li><a href="#">Recibos</a></li>
                        <li><a href="#">Upload Mecanizada</a></li>
                        <li><a href="#">Download Mecanizada</a></li>
                    </ul>
                </div>
                <!-- Coluna 5: Logo Governo -->
                <div>
                    <!-- Logo do Governo SP -->
                    <img src="https://i.ibb.co/S7ZTBmSz/logo-governo-do-estado-sp.png" alt="[Imagem do logo do Governo de S√£o Paulo]" class="mt-4">
                </div>
            </div>
        </div>
    </footer>
    <div class="footer-bottom">
        <span>¬© 2025-2026 - Portal da Corregedoria PM-SP.</span>
    </div>

    <!-- MODAL: Login do Admin -->
    <div id="admin-login-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-center mb-6">Acesso Restrito</h2>
            <p class="text-center text-gray-600 mb-4">Digite a senha de administrador:</p>
            <input type="password" id="admin-password" class="form-input mb-4">
            <button id="admin-login-btn" class="btn btn-primary w-full">Entrar</button>
            <p id="admin-error" class="text-red-500 text-center mt-4 hidden">Senha incorreta.</p>
            <button id="admin-close-btn" class="absolute top-4 right-4 text-2xl text-gray-600 hover:text-gray-900">&times;</button>
        </div>
    </div>

    <!-- MODAL: Alerta Gen√©rico -->
    <div id="alert-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h2 id="alert-title" class="text-2xl font-bold mb-4">Aviso</h2>
            <p id="alert-message" class="text-lg text-gray-700 mb-6"></p>
            <button id="alert-close-btn" class="btn btn-primary">Entendi</button>
        </div>
    </div>


    <!-- SCRIPT PRINCIPAL (com Firebase) -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            addDoc,
            updateDoc,
            collection, 
            query, 
            where, 
            getDocs,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Vari√°veis Globais de Configura√ß√£o ---

        // ### SUAS CHAVES DO FIREBASE J√Å EST√ÉO AQUI ###
        const firebaseConfig = {
          apiKey: "AIzaSyA6rE5-nwdGtx-nJrO3GtSLCIP-GPXSYZc",
          authDomain: "dpmconcurso.firebaseapp.com",
          projectId: "dpmconcurso",
          storageBucket: "dpmconcurso.firebasestorage.app",
          messagingSenderId: "594588201356",
          appId: "1:594588201356:web:7d1b68d02f94df376c26a9"
        };
        // ### FIM DAS CHAVES ###

        // --- Constantes da Aplica√ß√£o ---
        const EXAM_TIME_MINUTES = 20;
        const ADMIN_PASSWORD = "admin123"; // Senha do admin
        const LOCAL_STORAGE_KEY = "examSubmitted";

        // --- Vari√°veis Globais do Firebase ---
        let app, db, auth;
        let userId = null; // ID do usu√°rio (ser√° pego do auth)

        // --- Estado da Aplica√ß√£o ---
        let currentPage = 'home';
        let currentQuestionIndex = 0;
        let examTimer;
        let timeLeft = EXAM_TIME_MINUTES * 60;
        let answers = {};
        let examInProgress = false;
        let cheatAttempts = 0; // Se tornar > 0, reprova

        // --- Banco de Quest√µes (12 Quest√µes) ---
        const questions = [
            // 10 Quest√µes M√∫ltipla Escolha
            {
                type: 'mc',
                question: "O que significa a sigla RDPM?",
                options: ["Regulamento de Defesa Policial Militar", "Regulamento Disciplinar da Pol√≠cia Militar", "Regras Distintivas da Pol√≠cia Militar", "Regimento de Deveres Policiais Militares"],
                answer: "Regulamento Disciplinar da Pol√≠cia Militar"
            },
            {
                type: 'mc',
                question: "Qual o objetivo principal do Inqu√©rito Policial Militar (IPM)?",
                options: ["Punir o militar imediatamente", "Apurar a exist√™ncia de crime militar e sua autoria", "Mediar conflitos entre civis e militares", "Conceder promo√ß√µes por bravura"],
                answer: "Apurar a exist√™ncia de crime militar e sua autoria"
            },
            {
                type: 'mc',
                question: "O que N√ÉO √© considerado um princ√≠pio da Administra√ß√£o P√∫blica (Art. 37 da CF)?",
                options: ["Legalidade", "Impessoalidade", "Moralidade", "Lucratividade"],
                answer: "Lucratividade"
            },
            {
                type: 'mc',
                question: "Receber vantagem indevida em raz√£o da fun√ß√£o √© um ato de:",
                options: ["Improbidade Administrativa", "Corrup√ß√£o Passiva", "Prevarica√ß√£o", "Todas as anteriores"],
                answer: "Todas as anteriores"
            },
            {
                type: 'mc',
                question: "Qual das seguintes a√ß√µes √© um exemplo de abuso de autoridade?",
                options: ["Usar a for√ßa necess√°ria para conter um agressor", "Dar ordem de parada a um ve√≠culo suspeito", "Constranger o preso a exibir-se para curiosos", "Realizar patrulhamento ostensivo em √°rea de risco"],
                answer: "Constranger o preso a exibir-se para curiosos"
            },
            {
                type: 'mc',
                question: "O militar que deixa de praticar ato de of√≠cio, com o fim de satisfazer interesse pessoal, comete crime de:",
                options: ["Concuss√£o", "Peculato", "Prevarica√ß√£o", "Desacato"],
                answer: "Prevarica√ß√£o"
            },
            {
                type: 'mc',
                question: "A Corregedoria da PM atua como √≥rg√£o de:",
                options: ["Controle interno e disciplina", "Recrutamento e sele√ß√£o", "Comunica√ß√£o social", "Log√≠stica e finan√ßas"],
                answer: "Controle interno e disciplina"
            },
            {
                type: 'mc',
                question: "O uso √©tico da for√ßa policial √© pautado pelos princ√≠pios de:",
                options: ["Oportunidade, Conveni√™ncia e Efici√™ncia", "Legalidade, Necessidade e Proporcionalidade", "Rapidez, For√ßa e Surpresa", "Autoridade, Poder e Hierarquia"],
                answer: "Legalidade, Necessidade e Proporcionalidade"
            },
            {
                type: 'mc',
                question: "A quem compete o policiamento ostensivo e a preserva√ß√£o da ordem p√∫blica, segundo a Constitui√ß√£o Federal?",
                options: ["√Äs Guardas Municipais", "Ao Ex√©rcito Brasileiro", "√Ä Pol√≠cia Federal", "√Äs Pol√≠cias Militares"],
                answer: "√Äs Pol√≠cias Militares"
            },
            {
                type: 'mc',
                question: "Qual a san√ß√£o para o militar que praticar ato de improbidade administrativa que importe em enriquecimento il√≠cito?",
                options: ["Apenas advert√™ncia verbal", "Perda dos bens ou valores acrescidos ilicitamente", "Transfer√™ncia de unidade", "Promo√ß√£o compuls√≥ria"],
                answer: "Perda dos bens ou valores acrescidos ilicitamente"
            },
            // 2 Quest√µes Dissertativas
            {
                type: 'essay',
                question: "Discorra sobre a import√¢ncia da imparcialidade e da √©tica na condu√ß√£o de uma apura√ß√£o disciplinar pela Corregedoria."
            },
            {
                type: 'essay',
                question: "Explique a diferen√ßa entre 'crime militar' e 'transgress√£o disciplinar', dando um exemplo de cada."
            }
        ];

        // --- Elementos do DOM ---
        const pages = document.querySelectorAll('.page-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const appContainer = document.getElementById('app-container');

        // Home
        const homePage = document.getElementById('page-home');

        // Prova
        const examPage = document.getElementById('page-exam-main');
        const step1 = document.getElementById('exam-step-1');
        const step2 = document.getElementById('exam-step-2');
        const step3 = document.getElementById('exam-step-3');
        const startExamBtn = document.getElementById('start-exam-btn');
        const timerEl = document.getElementById('timer');
        const qCounterEl = document.getElementById('question-counter');
        const qContainer = document.getElementById('question-container');
        const prevBtn = document.getElementById('prev-question-btn');
        const nextBtn = document.getElementById('next-question-btn');
        const submitBtn = document.getElementById('submit-exam-btn');
        const successMsg = document.getElementById('exam-success-msg');
        const failMsg = document.getElementById('exam-fail-msg');
        const blockedMsg = document.getElementById('exam-blocked-msg');

        // Resultados
        const resultsPage = document.getElementById('page-results');
        const searchIdRgEl = document.getElementById('search-idRg');
        const searchBtn = document.getElementById('search-result-btn');
        const resultDisplay = document.getElementById('result-display');

        // Admin
        const adminPage = document.getElementById('page-admin');
        const adminTableBody = document.getElementById('admin-table-body');
        const adminLoginModal = document.getElementById('admin-login-modal');
        const adminPasswordEl = document.getElementById('admin-password');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminCloseBtn = document.getElementById('admin-close-btn');
        const adminError = document.getElementById('admin-error');

        // Modais
        const alertModal = document.getElementById('alert-modal');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');
        const alertCloseBtn = document.getElementById('alert-close-btn');

        // --- Fun√ß√µes Auxiliares ---

        /**
         * Navega entre as p√°ginas do App
         */
        function navigateTo(pageName) {
            // Esconde todas as p√°ginas
            pages.forEach(page => page.classList.add('hidden'));
            
            // Remove 'active' de todos os links da barra de nav
            navLinks.forEach(link => link.classList.remove('active'));

            // Mostra a p√°gina e o link ativo correspondente
            const activePage = document.getElementById(`page-${pageName}`);
            let activeLink = document.querySelector(`.nav-link[data-page="${pageName}"]`); // Pega s√≥ os links da barra de nav
            
            // Tratamento especial para o link de admin (que n√£o √© a p√°gina 'admin')
            if (pageName === 'admin') {
                activePage.classList.remove('hidden');
                activeLink = document.querySelector(`.nav-link[data-page="admin-trigger"]`);
            } else if (activePage) {
                activePage.classList.remove('hidden');
            } else {
                // Se a p√°gina n√£o existir, volta para home
                homePage.classList.remove('hidden');
                activeLink = document.querySelector(`.nav-link[data-page="home"]`);
                pageName = 'home';
            }
            
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // Se a pageName for home, for√ßa o link "Portal de Not√≠cias" a ficar ativo
            if (pageName === 'home') {
                const homeNavLink = document.querySelector('.nav-link[data-page="home"]');
                if (homeNavLink) homeNavLink.classList.add('active');
            }
            
            currentPage = pageName;

            // L√≥gica espec√≠fica da p√°gina
            if (pageName === 'admin') {
                // N√£o chama o showAdminLogin() aqui, pois j√° foi logado
                loadAdminPanel();
            }
        }

        /**
         * Exibe um modal de alerta personalizado
         */
        function showAlert(title, message) {
            alertTitle.innerText = title;
            alertMessage.innerText = message;
            alertModal.classList.remove('hidden');
        }

        /**
         * Formata o tempo (MM:SS)
         */
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // --- Fun√ß√µes do Firebase ---

        /**
         * Inicializa o Firebase e autentica o usu√°rio
         */
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug'); // Habilita logs
                
                // Ouve mudan√ßas no estado da autentica√ß√£o
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // Usu√°rio est√° logado
                        userId = user.uid;
                        console.log("Usu√°rio autenticado:", userId);
                        
                        // Ap√≥s autenticar, verificamos se ele pode fazer a prova
                        if (currentPage === 'exam-main') {
                            await checkExamStatus();
                        }

                    } else {
                        // Usu√°rio n√£o est√° logado, tenta logar anonimamente
                        console.log("Nenhum usu√°rio. Tentando login an√¥nimo...");
                        try {
                            const userCredential = await signInAnonymously(auth);
                            userId = userCredential.user.uid;
                            console.log("Login an√¥nimo bem-sucedido:", userId);
                        } catch (error) {
                            console.error("Erro no login an√¥nimo:", error);
                            // Este √© o erro que o usu√°rio est√° vendo.
                            if (error.code === 'auth/configuration-not-found') {
                                showAlert("Erro de Configura√ß√£o", "Falha ao autenticar (auth/configuration-not-found). O administrador precisa habilitar o login An√¥nimo no painel do Firebase.");
                            } else if (error.code === 'auth/admin-restricted-operation') {
                                showAlert("Erro de Configura√ß√£o", "Falha ao autenticar (auth/admin-restricted-operation). Verifique as restri√ß√µes da API Key no Google Cloud (veja instrucoes.md).");
                            } else {
                                showAlert("Erro de Autentica√ß√£o", `Erro inesperado: ${error.message}`);
                            }
                        }
                    }
                });

            } catch (error) {
                console.error("Erro ao inicializar Firebase:", error);
                showAlert("Erro Cr√≠tico", "Falha ao carregar os servi√ßos. O site n√£o funcionar√° corretamente.");
            }
        }

        /**
         * Verifica se o usu√°rio j√° fez a prova (localStorage e Firestore)
         */
        async function checkExamStatus() {
            if (!userId) {
                console.warn("CheckExamStatus chamado sem userId");
                return;
            }

            // 1. Verifica localStorage (bloqueio r√°pido)
            if (localStorage.getItem(LOCAL_STORAGE_KEY) === userId) {
                showExamBlocked();
                return;
            }

            // 2. Verifica Firestore (verifica√ß√£o definitiva)
            try {
                const docRef = doc(db, "examSubmissions", userId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    console.log("Documento encontrado no Firestore. Bloqueando prova.");
                    localStorage.setItem(LOCAL_STORAGE_KEY, userId); // Sincroniza localStorage
                    showExamBlocked();
                } else {
                    console.log("Nenhum registro encontrado. Prova liberada.");
                    // Usu√°rio pode fazer a prova, mostra a Etapa 1
                    step1.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Erro ao verificar status da prova:", error);
                showAlert("Erro de Verifica√ß√£o", "N√£o foi poss√≠vel verificar seu status. Tente novamente.");
            }
        }

        /**
         * Salva todos os dados da prova no Firestore
         */
        async function saveExamToFirebase(status = "Conclu√≠do", reason = "") {
            if (!userId) {
                showAlert("Erro Cr√≠tico", "Usu√°rio n√£o autenticado. N√£o foi poss√≠vel salvar.");
                return;
            }

            const identification = {
                name: document.getElementById('name').value,
                discord: document.getElementById('discord').value,
                idRg: document.getElementById('idRg').value,
                phone: document.getElementById('phone').value,
            };

            const examData = {
                userId: userId,
                identification: identification,
                answers: answers,
                status: status, // "Conclu√≠do", "Reprovado por Fraude", "Tempo Esgotado"
                reason: reason,
                timeLeft: formatTime(timeLeft),
                submittedAt: new Date().toISOString()
            };

            try {
                // Usamos o userId como ID do documento para garantir tentativa √∫nica
                const docRef = doc(db, "examSubmissions", userId);
                await setDoc(docRef, examData);
                
                console.log("Prova salva com sucesso!");
                localStorage.setItem(LOCAL_STORAGE_KEY, userId); // Bloqueia localmente
                
                if (status === "Reprovado por Fraude") {
                    showExamFailed();
                } else {
                    showExamSuccess();
                }

            } catch (error) {
                console.error("Erro ao salvar prova no Firestore:", error);
                showAlert("Erro ao Enviar", "N√£o foi poss√≠vel enviar suas respostas. Verifique sua conex√£o e tente novamente.");
            }
        }

        // --- Fun√ß√µes da Prova ---

        /**
         * Inicia a prova (Etapa 1 -> Etapa 2)
         */
        function startExam() {
            // Valida√ß√£o dos campos
            const name = document.getElementById('name').value;
            const discord = document.getElementById('discord').value;
            const idRg = document.getElementById('idRg').value;
            const phone = document.getElementById('phone').value;

            if (!name || !discord || !idRg || !phone) {
                showAlert("Dados Incompletos", "Por favor, preencha todos os campos de identifica√ß√£o.");
                return;
            }

            // Salva as respostas (vazias) para o caso de o usu√°rio n√£o responder
            for (let i = 0; i < questions.length; i++) {
                answers[i] = "";
            }

            step1.classList.add('hidden');
            step2.classList.remove('hidden');
            examInProgress = true;

            renderQuestion(currentQuestionIndex);
            startTimer();
            setupCheatDetection();
        }

        /**
         * Renderiza a quest√£o atual
         */
        function renderQuestion(index) {
            const q = questions[index];
            qContainer.innerHTML = ""; // Limpa o container

            let questionHTML = `<h2 class="text-2xl font-semibold mb-6">(Q${index + 1}) ${q.question}</h2>`;

            if (q.type === 'mc') {
                questionHTML += '<div class="space-y-4">';
                q.options.forEach((option, i) => {
                    const isSelected = answers[index] === option;
                    questionHTML += `
                        <label class="question-option ${isSelected ? 'selected' : ''}">
                            <input type="radio" name="question${index}" value="${option}" class="hidden" ${isSelected ? 'checked' : ''}>
                            <span class="text-lg">${option}</span>
                        </label>
                    `;
                });
                questionHTML += '</div>';
            } else if (q.type === 'essay') {
                questionHTML += `
                    <textarea id="essay-answer-${index}" class="form-input" rows="8" placeholder="Digite sua resposta...">${answers[index] || ''}</textarea>
                `;
            }

            qContainer.innerHTML = questionHTML;
            qCounterEl.innerText = `Quest√£o ${index + 1} de ${questions.length}`;

            // Adiciona listeners de evento
            if (q.type === 'mc') {
                document.querySelectorAll(`.question-option`).forEach(label => {
                    label.addEventListener('click', () => handleOptionSelect(index, label));
                });
            } else if (q.type === 'essay') {
                document.getElementById(`essay-answer-${index}`).addEventListener('input', (e) => {
                    answers[index] = e.target.value;
                });
            }

            updateNavButtons();
        }

        /**
         * Salva a sele√ß√£o de m√∫ltipla escolha
         */
        function handleOptionSelect(index, selectedLabel) {
            // Remove 'selected' de todas
            document.querySelectorAll(`.question-option`).forEach(label => {
                label.classList.remove('selected');
            });
            // Adiciona 'selected' √† clicada
            selectedLabel.classList.add('selected');
            // Salva a resposta
            answers[index] = selectedLabel.querySelector('input').value;
        }

        /**
         * Atualiza a visibilidade dos bot√µes de navega√ß√£o
         */
        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        /**
         * Inicia o cron√¥metro
         */
        function startTimer() {
            timerEl.innerText = formatTime(timeLeft);
            examTimer = setInterval(() => {
                timeLeft--;
                timerEl.innerText = formatTime(timeLeft);

                if (timeLeft <= 0) {
                    endExam("Tempo Esgotado");
                }
            }, 1000);
        }

        /**
         * Configura a detec√ß√£o anti-fraude
         */
        function setupCheatDetection() {
            // 1. Detec√ß√£o de mudan√ßa de aba
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && examInProgress) {
                    console.log("FRAUDE: Mudan√ßa de aba detectada.");
                    cheatAttempts++;
                    endExam("Reprovado por Fraude", "Mudan√ßa de aba/janela detectada.");
                }
            });

            // 2. Detec√ß√£o de Copiar e Colar
            const forbiddenEvents = ['copy', 'paste', 'cut'];
            forbiddenEvents.forEach(event => {
                document.addEventListener(event, (e) => {
                    if (examInProgress) {
                        console.log(`FRAUDE: ${event} detectado.`);
                        e.preventDefault();
                        cheatAttempts++;
                        endExam("Reprovado por Fraude", `Tentativa de ${event} detectada.`);
                    }
                });
            });
        }
        
        /**
         * Termina a prova (salva e muda para Etapa 3)
         */
        function endExam(status = "Conclu√≠do", reason = "") {
            if (!examInProgress) return; // Evita envios duplicados
            
            examInProgress = false;
            clearInterval(examTimer);

            // Salva a resposta dissertativa final (se estiver nela)
            const q = questions[currentQuestionIndex];
            if (q.type === 'essay') {
                const textarea = document.getElementById(`essay-answer-${currentQuestionIndex}`);
                if (textarea) answers[currentQuestionIndex] = textarea.value;
            }

            console.log("Terminando a prova. Status:", status);
            console.log("Respostas finais:", answers);

            // Salva no Firebase
            saveExamToFirebase(status, reason);
        }

        // Fun√ß√µes de exibi√ß√£o de status da prova
        function showExamSuccess() {
            step2.classList.add('hidden');
            step3.classList.remove('hidden');
            successMsg.classList.remove('hidden');
            failMsg.classList.add('hidden');
            blockedMsg.classList.add('hidden');
        }

        function showExamFailed() {
            step2.classList.add('hidden');
            step3.classList.remove('hidden');
            successMsg.classList.add('hidden');
            failMsg.classList.remove('hidden');
            blockedMsg.classList.add('hidden');
        }

        function showExamBlocked() {
            step1.classList.add('hidden');
            step2.classList.add('hidden');
            step3.classList.remove('hidden');
            successMsg.classList.add('hidden');
            failMsg.classList.add('hidden');
            blockedMsg.classList.remove('hidden');
        }

        // --- Fun√ß√µes da P√°gina de Resultados ---

        /**
         * Busca o resultado do candidato pelo ID/RG
         */
        async function searchResult() {
            const idRg = searchIdRgEl.value.trim();
            if (!idRg) {
                showAlert("Campo Vazio", "Por favor, digite o ID/RG.");
                return;
            }

            resultDisplay.classList.add('hidden');
            resultDisplay.innerHTML = `<p class="text-center text-gray-500">Buscando...</p>`;
            resultDisplay.classList.remove('hidden');

            try {
                // Como n√£o podemos buscar por um sub-campo (identification.idRg) sem um √≠ndice
                // composto, e as regras do Firebase s√£o complexas, vamos buscar todos
                // e filtrar no cliente.
                // **Nota:** Isso n√£o √© ideal para performance com muitos usu√°rios.
                
                const q = query(collection(db, "examSubmissions"));
                const querySnapshot = await getDocs(q);
                
                let foundDoc = null;
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.identification && data.identification.idRg === idRg) {
                        foundDoc = data;
                    }
                });

                if (foundDoc) {
                    displayResult(foundDoc);
                } else {
                    resultDisplay.innerHTML = `<p class="text-center text-lg font-semibold text-red-600">Nenhum resultado encontrado para este ID/RG.</p>`;
                }

            } catch (error) {
                console.error("Erro ao buscar resultado:", error);
                resultDisplay.innerHTML = `<p class="text-center text-red-600">Erro ao consultar o banco de dados.</p>`;
            }
        }

        /**
         * Exibe o resultado encontrado
         */
        function displayResult(data) {
            let statusText, statusColor;
            switch (data.status) {
                case "Aprovado":
                    statusText = "APROVADO";
                    statusColor = "text-green-600";
                    break;
                case "Reprovado":
                case "Reprovado por Fraude":
                case "Tempo Esgotado":
                    statusText = "REPROVADO";
                    statusColor = "text-red-600";
                    break;
                default:
                    statusText = "PENDENTE";
                    statusColor = "text-yellow-600";
            }

            resultDisplay.innerHTML = `
                <h3 class="text-xl font-bold mb-2">Candidato: ${data.identification.name}</h3>
                <p class="text-lg"><strong>ID/RG:</strong> ${data.identification.idRg}</p>
                <div class="mt-4 pt-4 border-t">
                    <p class="text-2xl font-bold text-center ${statusColor}">${statusText}</p>
                    ${data.reason ? `<p class="text-center text-sm text-gray-500">Motivo: ${data.reason}</p>` : ''}
                </div>
            `;
        }

        // --- Fun√ß√µes do Admin ---

        /**
         * Exibe o modal de login do admin
         */
        function showAdminLogin() {
            adminPasswordEl.value = "";
            adminError.classList.add('hidden');
            adminLoginModal.classList.remove('hidden');
        }

        /**
         * Valida a senha do admin
         */
        function handleAdminLogin() {
            if (adminPasswordEl.value === ADMIN_PASSWORD) {
                adminLoginModal.classList.add('hidden');
                // **CORRE√á√ÉO DO BUG:** Navega para a P√ÅGINA de admin
                navigateTo('admin'); 
            } else {
                adminError.classList.remove('hidden');
            }
        }

        /**
         * Carrega todos os resultados no painel do admin
         */
        async function loadAdminPanel() {
            adminTableBody.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-gray-500">Carregando resultados...</td></tr>`;

            try {
                const q = query(collection(db, "examSubmissions"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    adminTableBody.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-gray-500">Nenhuma prova foi enviada ainda.</td></tr>`;
                    return;
                }

                adminTableBody.innerHTML = ""; // Limpa a tabela
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const docId = doc.id; // O docId √© o userId

                    let statusClass = "";
                    if (data.status === "Aprovado") statusClass = "text-green-600";
                    if (data.status === "Reprovado" || data.status === "Reprovado por Fraude") statusClass = "text-red-600";
                    if (data.status === "Pendente" || data.status === "Conclu√≠do") statusClass = "text-yellow-600";

                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">${data.identification.name}</td>
                        <td class="py-3 px-4">${data.identification.idRg}</td>
                        <td class="py-3 px-4">${data.identification.discord}</td>
                        <td class="py-3 px-4 font-semibold ${statusClass}">${data.status}</td>
                        <td class="py-3 px-4">
                            <button class="btn btn-success text-sm py-1 px-2 mr-2" data-id="${docId}" data-action="approve">Aprovar</button>
                            <button class="btn btn-danger text-sm py-1 px-2" data-id="${docId}" data-action="reject">Reprovar</button>
                        </td>
                    `;
                    adminTableBody.appendChild(row);
                });

            } catch (error) {
                console.error("Erro ao carregar painel admin:", error);
                adminTableBody.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-red-500">Erro ao carregar dados.</td></tr>`;
            }
        }

        /**
         * Atualiza o status de um candidato (Aprovar/Reprovar)
         */
        async function updateSubmissionStatus(userId, newStatus) {
            const docRef = doc(db, "examSubmissions", userId);
            try {
                await updateDoc(docRef, {
                    status: newStatus
                });
                console.log(`Status atualizado para ${newStatus} para o usu√°rio ${userId}`);
                loadAdminPanel(); // Recarrega o painel
            } catch (error) {
                console.error("Erro ao atualizar status:", error);
                showAlert("Erro", "N√£o foi poss√≠vel atualizar o status.");
            }
        }

        // --- Event Listeners (Ouvintes de Eventos) ---

        /**
         * Event Listeners da Navega√ß√£o
         */
        // Pega TODOS os links clic√°veis da navega√ß√£o (inclusive o logo)
        const allNavTriggers = document.querySelectorAll('a[data-page]');

        allNavTriggers.forEach(link => { // MUDADO para allNavTriggers
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageName = e.currentTarget.getAttribute('data-page'); // MUDADO para currentTarget
                
                // Link "secreto" do admin
                if (pageName === 'admin-trigger') {
                    showAdminLogin();
                } else if (pageName) {
                    navigateTo(pageName);
                }
            });
        });

        // Listeners da Prova
        startExamBtn.addEventListener('click', startExam);
        
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }
        });

        submitBtn.addEventListener('click', () => {
            // Confirma√ß√£o antes de enviar
            showAlert("Confirmar Envio", "Voc√™ tem certeza que deseja enviar sua prova? Esta a√ß√£o n√£o pode ser desfeita.");
            // Substitui o bot√£o "Entendi" do alerta para ser um bot√£o de confirma√ß√£o
            alertCloseBtn.innerText = "Enviar Agora";
            
            // Remove listener antigo para evitar duplicidade
            const newCloseBtn = alertCloseBtn.cloneNode(true);
            alertCloseBtn.parentNode.replaceChild(newCloseBtn, alertCloseBtn);
            
            newCloseBtn.addEventListener('click', () => {
                newCloseBtn.innerText = "Entendi"; // Restaura o texto
                alertModal.classList.add('hidden');
                endExam("Conclu√≠do");
            }, { once: true }); // Executa apenas uma vez
        });

        // Listeners dos Resultados
        searchBtn.addEventListener('click', searchResult);
        searchIdRgEl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchResult();
        });

        // Listeners do Admin
        adminLoginBtn.addEventListener('click', handleAdminLogin);
        adminPasswordEl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleAdminLogin();
        });
        adminCloseBtn.addEventListener('click', () => {
            adminLoginModal.classList.add('hidden');
            navigateTo('home'); // Se fechar o modal, volta pra home
        });

        // Listener para os bot√µes de Aprovar/Reprovar (delega√ß√£o de evento)
        adminTableBody.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const action = e.target.getAttribute('data-action');
                const id = e.target.getAttribute('data-id');
                if (action === 'approve') {
                    updateSubmissionStatus(id, "Aprovado");
                } else if (action === 'reject') {
                    updateSubmissionStatus(id, "Reprovado");
                }
            }
        });

        // Listeners dos Modais
        alertCloseBtn.addEventListener('click', () => alertModal.classList.add('hidden'));

        // --- Inicializa√ß√£o ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            navigateTo('home'); // Come√ßa na p√°gina inicial
        });

    </script>

</body>
</html>